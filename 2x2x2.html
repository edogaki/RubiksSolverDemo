<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2x2x2 Rubik's Cube Solver</title>
    <meta name="description" content="Solver for 2x2x2 Rubik's Cube">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-MXJH30352W"></script>
    <script async src="src/min2phase.js/min2phase.js"></script>
    <script async src="src/functions/list.js"></script>
    <script src="src/functions/functions.js"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-MXJH30352W');
    </script>
    <style>
        header {
            padding: 2px;
            text-align: center;
            cursor: pointer;
            background-color: #121212;
        }

        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 0;
            background-color: #121212;
        }

        h1 {
            font-family: Arial, sans-serif;
            font-size: 24px;
            text-align: center;
            color: #ffffff;
        }

        h2,
        label {
            font-family: Arial, sans-serif;
            font-size: 20px;
            text-align: left;
            color: #ffffff;
        }

        textarea {
            font-family: Arial, sans-serif;
            width: 100%;
            max-width: 700px;
            height: 200px;
            font-size: 20px;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #41417f;
            border-radius: 4px;
            box-sizing: border-box;
            background-color: #1e1e1e;
            color: #ffffff;
        }

        input {
            font-family: Arial, sans-serif;
            width: 100%;
            max-width: 100px;
            height: 40px;
            font-size: 20px;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #41417f;
            border-radius: 4px;
            box-sizing: border-box;
            background-color: #1e1e1e;
            color: #ffffff;
        }

        select {
            font-family: Arial, sans-serif;
            max-width: 200px;
            font-size: 20px;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ffffff;
            border-radius: 4px;
            box-sizing: border-box;
            background-color: #1e1e1e;
            color: #ffffff;
            cursor: pointer;
        }

        .button {
            font-family: Arial, sans-serif;
            width: 100%;
            font-size: 20px;
            padding: 10px;
            background-color: #56567c;
            color: #ffffff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .medium {
            max-width: 100px;
        }

        .small {
            max-width: 40px;
        }

        button:hover {
            background-color: #4a4a6d;
        }

        summary {
            box-sizing: border-box;
            display: block;
            font-family: Arial, sans-serif;
            padding: 10px;
            font-size: 20px;
            color: #ffffff;
            width: 100%;
            max-width: 750px;
            cursor: pointer;
        }

        details {
            border: 1px solid #41417f;
            padding: 5px;
            margin: 10px 0;
        }

        .hidden {
            display: none;
        }

        .hidden_small {
            visibility: hidden;
        }

        a,
        pre {
            color: #ffffff;
            font-family: Arial, sans-serif;
            font-size: 20px;
        }

        twisty-player {
            margin: 0;
            width: 100%;
            max-width: 600px;
        }
    </style>
</head>

<body>
    <header id="header">
        <h1>2x2x2 Rubik's Cube Solver</h1>
    </header>
    <a href="https://github.com/or18/RubiksSolverDemo" rel="noopener noreferrer"
        style="white-space: nowrap;">Source</a><a>&nbsp;</a>
    <a href="https://or18.github.io/RubiksSolverDemo/" rel="noopener noreferrer" style="white-space: nowrap;">Main 3x3x3
        Solver</a>
    <a href="https://or18.github.io/Rubiks-cube-xcross-solver/" rel="noopener noreferrer"
        style="white-space: nowrap;">Old Demo</a><br><br>
    <a>Trainers:</a><br>
    <a href="https://or18.github.io/RubiksSolverDemo/cross_trainer" rel="noopener noreferrer"
        style="white-space: nowrap;">Cross</a><a>&nbsp;</a>
    <a href="https://or18.github.io/RubiksSolverDemo/xcross_trainer" rel="noopener noreferrer"
        style="white-space: nowrap;">XCross</a><a>&nbsp;</a>
    <a href="https://or18.github.io/RubiksSolverDemo/pairing_trainer" rel="noopener noreferrer"
        style="white-space: nowrap;">Free Pair</a><a>&nbsp;</a>
    <a href="https://or18.github.io/RubiksSolverDemo/pseudo_xcross_trainer" rel="noopener noreferrer"
        style="white-space: nowrap;">Pseudo XCross</a><a>&nbsp;</a>
    <a href="https://or18.github.io/RubiksSolverDemo/pseudo_pairing_trainer" rel="noopener noreferrer"
        style="white-space: nowrap;">Pseudo Free Pair</a><a>&nbsp;</a>
    <a href="https://or18.github.io/RubiksSolverDemo/eocross_trainer" rel="noopener noreferrer"
        style="white-space: nowrap;">EOCross</a><br><br>
    <button id="undo" class="button small hidden_small" onclick="undo()">←</button>
    <button id="redo" class="button small hidden_small" onclick="redo()">→</button><br>
    <label for="scr">Scramble: </label><br>
    <textarea id="scr" rows="10" cols="10" placeholder="Use // to write comments, as in algs // comment. 
Write the //setup comment in the appropriate position when viewing on alg.cubing.net or cubedb.net."
        onchange="save()"></textarea><br>
    <button id="reverse" class="button medium" onclick="reverseScramble()">Reverse</button>
    <button id="mirror" class="button medium" onclick="mirrorScramble()">Mirror</button><br><br>
    <details id="details_preview">
        <summary id="summary_preview">Show Preview</summary>
        <div id="show"></div>
        <pre id="links"
            class="hidden"><a translate="no" id="link_alg_cubing" href="https://alg.cubing.net/&puzzle=2x2x2" target="_blank" rel="noopener noreferrer">alg.cubing.net</a>  <a translate="no" id="link_cubedb" href="https://cubedb.net/?puzzle=2x2" target="_blank" rel="noopener noreferrer">cubedb.net</a></pre>
    </details>

    <label for="rot">Rotation: </label>
    <select translate="no" id="rot" onchange="updateUrlParams()">
        <option translate="no" value="">None</option>
        <option translate="no" value="y">y</option>
        <option translate="no" value="y2">y2</option>
        <option translate="no" value="y'">y'</option>
        <option translate="no" value="z2">z2</option>
        <option translate="no" value="z2 y">z2 y</option>
        <option translate="no" value="z2 y2">z2 y2</option>
        <option translate="no" value="z2 y'">z2 y'</option>
        <option translate="no" value="z'">z'</option>
        <option translate="no" value="z' y">z' y</option>
        <option translate="no" value="z' y2">z' y2</option>
        <option translate="no" value="z' y'">z' y'</option>
        <option translate="no" value="z">z</option>
        <option translate="no" value="z y">z y</option>
        <option translate="no" value="z y2">z y2</option>
        <option translate="no" value="z y'">z y'</option>
        <option translate="no" value="x'">x'</option>
        <option translate="no" value="x' y">x' y</option>
        <option translate="no" value="x' y2">x' y2</option>
        <option translate="no" value="x' y'">x' y'</option>
        <option translate="no" value="x2">x2</option>
        <option translate="no" value="x2 y">x2 y</option>
        <option translate="no" value="x2 y2">x2 y2</option>
        <option translate="no" value="x2 y'">x2 y'</option>
        <option translate="no" value="x">x</option>
        <option translate="no" value="x y">x y</option>
        <option translate="no" value="x y2">x y2</option>
        <option translate="no" value="x y'">x y'</option>
    </select><br>
    <div id="basic input">
        <label for="len">Max Length: </label>
        <input type="number" id="len" value="20" min="1" required onchange="updateUrlParams()"><br>
        <label for="num">Max Count: </label>
        <input type="number" id="num" value="20" min=1 required onchange="updateUrlParams()"><br>
        <label for="res">Move Restrict: </label>
        <select translate="no" id="res" onchange="updateUrlParams()">
            <option translate="no" value="UDLRFB">UDLRFB</option>
            <option translate="no" value="UDRF">UDRF</option>
            <option translate="no" value="UDLF">UDLF</option>
            <option translate="no" value="UDRB">UDRB</option>
            <option translate="no" value="UDLB">UDLB</option>
            <option translate="no" value="UDLR">UDLR</option>
            <option translate="no" value="URFB">URFB</option>
            <option translate="no" value="ULFB">ULFB</option>
            <option translate="no" value="URF" selected>URF</option>
            <option translate="no" value="ULF">ULF</option>
            <option translate="no" value="URB">URB</option>
            <option translate="no" value="ULB">ULB</option>
            <option translate="no" value="UDR">UDR</option>
            <option translate="no" value="UDL">UDL</option>
            <option translate="no" value="ULR">ULR</option>
            <option translate="no" value="ULR">UFB</option>
            <option translate="no" value="UR">UR</option>
            <option translate="no" value="UL">UL</option>
        </select><br>
        <label for="prune">Prune depth: </label>
        <select translate="no" id="prune">
            <option translate="no" value="1">1</option>
            <option translate="no" value="2">2</option>
            <option translate="no" value="3">3</option>
            <option translate="no" value="4">4</option>
            <option translate="no" value="5">5</option>
            <option translate="no" value="6">6</option>
            <option translate="no" value="7">7</option>
            <option translate="no" value="8" selected>8</option>
            <option translate="no" value="9">9</option>
            <option translate="no" value="10">10</option>
            <option translate="no" value="11">11</option>
        </select><br>
        <button id="solveButton" class="button medium" onclick="startWorker()">Start</button><br>
        <label for="countLine">Number of solutions: </label>
        <input type="text" id="countLine" value="0" readonly>
        <div id="result"></div>

        <script type="module">
            import { TwistyPlayer } from "https://cdn.cubing.net/v0/js/cubing/twisty";
            function createPlayer(setup, sol) {
                const player = new TwistyPlayer({
                    puzzle: "2x2x2",
                    experimentalSetupAlg: setup,
                    alg: sol,
                    background: "none"
                });
                return player;
            }
            window.createPlayer = createPlayer;
        </script>

        <script>
            Module.onRuntimeInitialized = function () {
                window.reverse = function (scr) {
                    const scr_fixed = scr_fix2(scr);
                    if (scr_fixed === "") {
                        return;
                    }
                    const lines = scr_fixed.split('\n');
                    const processedLines = [];
                    for (let i = lines.length - 1; i >= 0; i--) {
                        const line = lines[i];
                        const [alg, comment] = line.split('//');
                        const alg_revresed = Module.scr_reverse(alg.trim());
                        if (comment) {
                            processedLines.push(`${alg_revresed} // ${comment.trim()}`);
                        } else {
                            processedLines.push(alg_revresed);
                        }
                    }
                    const result = processedLines.join('\n');
                    return result.trim() + "\n";
                };
                window.mirror = function (scr) {
                    if (typeof Module.scr_mirror !== "function") {
                        alert("Error: The required function is not initialized. Please reload the page manually.");
                        return;
                    }
                    const scr_fixed = scr_fix2(scr);
                    if (scr_fixed === "") {
                        return;
                    }
                    const lines = scr_fixed.split('\n');
                    const processedLines = [];
                    for (let i = 0; i < lines.length; i++) {
                        const line = lines[i];
                        const [alg, comment] = line.split('//');
                        const alg_mirrored = Module.scr_mirror(alg.trim());
                        if (comment) {
                            processedLines.push(`${alg_mirrored} // ${comment.trim()}`);
                        } else {
                            processedLines.push(alg_mirrored);
                        }
                    }
                    const result = processedLines.join('\n');
                    return result.trim() + "\n";
                };
                window.convert = function (scramble) {
                    const result = Module.scr_converter(scramble);
                    const resultArray = result.split(',');
                    return resultArray.map(part => part.trim());
                };
            };
        </script>

        <script>
            let worker;
            let messageCount = 0;
            let sol_input = false;

            function scr_fix(scr) {
                const fixed_scr = scr_fix2(scr);
                const output = fixed_scr.split('\n')
                    .map(line => line.split('//')[0].trim())
                    .filter(line => line.length > 0)
                    .join('\n');
                return output;
            }

            function scr_fix2(scr) {
                const outputString = scr.split('\n').map(line => {
                    const commentIndex = line.indexOf('//');
                    if (commentIndex !== -1) {
                        const beforeComment = insertSpaces(line.slice(0, commentIndex));
                        const comment = line.slice(commentIndex);
                        return beforeComment + ' ' + comment.trim();
                    } else {
                        return insertSpaces(line);
                    }
                }).join('\n');
                return outputString;
            }

            function insertSpaces(input) {
                const keys = ["U", "U2", "U2'", "U'", "D", "D2", "D2'", "D'", "L", "L2", "L2'", "L'", "R", "R2", "R2'", "R'", "F", "F2", "F2'", "F'", "B", "B2", "B2'", "B'", "u", "u2", "u2'", "u'", "d", "d2", "d2'", "d'", "l", "l2", "l2'", "l'", "r", "r2", "r2'", "r'", "f", "f2", "f2'", "f'", "b", "b2", "b2'", "b'", "Uw", "Uw2", "Uw2'", "Uw'", "Dw", "Dw2", "Dw2'", "Dw'", "Lw", "Lw2", "Lw2'", "Lw'", "Rw", "Rw2", "Rw2'", "Rw'", "Fw", "Fw2", "Fw2'", "Fw'", "Bw", "Bw2", "Bw2'", "Bw'", "M", "M2", "M2'", "M'", "S", "S2", "S2'", "S'", "E", "E2", "E2'", "E'", "x", "x2", "x2'", "x'", "y", "y2", "y2'", "y'", "z", "z2", "z2'", "z'"];
                const regex = new RegExp(`(${keys.join('|')})`, 'g');
                return input.replace(regex, ' $1').trim()
                    .replace(/\s+/g, ' ');
            }

            function replaceCharacters(input) {
                return input
                    .replace(/'/g, '-')
                    .replace(/\n/g, '%0A')
                    .replace(/\//g, '%2F')
                    .replace(/ /g, '_');
            }

            function splitAtLastScramble(input) {
                const scrambleRegex = /\/\/\s*setup/g;
                const index = input.search(scrambleRegex);
                if (index !== -1) {
                    const scrambleLineEnd = input.indexOf('\n', index);
                    const scrambleLine = input.slice(index, scrambleLineEnd !== -1 ? scrambleLineEnd : undefined).trim();
                    const aboveScramble = input.slice(0, scrambleLineEnd !== -1 ? scrambleLineEnd : input.length).trim();
                    const belowScramble = input.slice(index + scrambleLine.length).trim();
                    return { aboveScramble, belowScramble };
                } else {
                    return { aboveScramble: input.trim(), belowScramble: '' };
                }
            }

            function getLink(scr) {
                const fixed_scr = scr_fix2(scr);
                const { aboveScramble, belowScramble } = splitAtLastScramble(fixed_scr);
                const transformedAbove = replaceCharacters(aboveScramble);
                const transformedBelow = replaceCharacters(belowScramble);
                const URL1 = "https://alg.cubing.net/?setup=" + transformedAbove + "&alg=" + transformedBelow + "%0A&puzzle=2x2x2";
                const URL2 = "https://cubedb.net/?puzzle=2x2&scramble=" + transformedAbove + "&alg=" + transformedBelow + "%0A";
                return { URL1, URL2 };
            }

            const idToKeyMap = {
                'scr': 'scramble',
                'rot': 'rot',
                'len': 'len',
                'num': 'num',
                'res': 'res'
            };

            const defaultValues = {
                '2x2x2': {
                    'scr': '',
                    'rot': '',
                    'slot': '',
                    'len': '20',
                    'num': '20',
                    'res': 'URF'
                }
            };

            const idList = [
                'scr',
                'rot',
                'len',
                'num',
                'res'
            ];

            function updateUrlParams() {
                const solver = "2x2x2";
                const url = new URL(window.location.href);
                const defaultValueTmp = defaultValues[solver];
                idList.forEach(id => {
                    const key = idToKeyMap[id];
                    var newValue = document.getElementById(id)?.value;
                    if (typeof key !== "undefined" && typeof defaultValueTmp[id] !== "undefined") {
                        if (id === 'scr') {
                            if (newValue !== '') {
                                newValue = encodeURIComponent(scr_fix2(newValue).replace(/ /g, '_').replace(/'/g, '-'));
                                url.searchParams.set(key, newValue);
                            } else {
                                url.searchParams.delete(key);
                            }
                        } else {
                            if ((document.getElementById(id).tagName === 'SELECT' && document.getElementById(id).selectedIndex > 0) || (document.getElementById(id).tagName === "INPUT" && newValue !== defaultValueTmp[id])) {
                                newValue = newValue.replace(/ /g, '_').replace(/'/g, '-');
                                url.searchParams.set(key, newValue);
                            } else {
                                url.searchParams.delete(key);
                            }
                        }
                    } else {
                        url.searchParams.delete(key);
                    }
                });
                try {
                    window.history.replaceState({}, '', url);
                } catch (e) {
                    console.log(e.message);
                }
            }

            function setParamsFromUrl(urlParams) {
                const solver = "2x2x2";
                document.getElementById('rot').value = urlParams.get(idToKeyMap['rot']) ? urlParams.get(idToKeyMap['rot']).replace(/_/g, ' ').replace(/-/g, '\'') : defaultValues[solver]['rot'];
                document.getElementById('len').value = urlParams.get(idToKeyMap['len']) ? urlParams.get(idToKeyMap['len']) : defaultValues[solver]['len'];
                document.getElementById('num').value = urlParams.get(idToKeyMap['num']) ? urlParams.get(idToKeyMap['num']) : defaultValues[solver]['num'];
                document.getElementById('res').value = urlParams.get(idToKeyMap['res']) ? urlParams.get(idToKeyMap['res']) : defaultValues[solver]['res'];
            }

            function startWorker() {
                try {
                    if (worker) {
                        worker.terminate();
                        worker = null;
                        const element = document.getElementById('result');
                        const content = document.createElement('a');
                        content.innerHTML = "Search terminated.<br>";
                        element.appendChild(content);
                        document.getElementById("solveButton").textContent = "Start";
                        return;
                    }

                    if (typeof convert !== "function") {
                        alert("Error: The required function is not initialized. Please reload the page manually.");
                        const element = document.getElementById('result');
                        const content = document.createElement('a');
                        content.innerHTML = "Error: Search terminated due an error.<br>";
                        element.appendChild(content);
                        document.getElementById("solveButton").textContent = "Start";
                        return;
                    }
                    document.getElementById("countLine").value = 0;
                    document.getElementById("result").innerHTML = "";
                    messageCount = 0;
                    const scr_val = document.getElementById("scr").value;
                    const scr = scr_fix(scr_val);
                    const scr2 = scr_fix2(scr_val);
                    if (scr === "") {
                        const element = document.getElementById('result');
                        const content = document.createElement('a');
                        content.innerHTML = "Input scramble.<br>";
                        element.appendChild(content);
                        return;
                    }
                    const rot = document.getElementById('rot').value;
                    const num = document.getElementById('num').value;
                    const len = document.getElementById('len').value;
                    const restrict = document.getElementById('res').value;
                    const prune = document.getElementById('prune').value;
                    document.getElementById("solveButton").textContent = "End";
                    const convertResult = convert(scr);
                    const result_moves = convertResult[0];
                    const result_rotation = convertResult[1] + " " + rot;

                    const args = { scr: result_moves, rot: rot, num: num, len: len, restrict: restrict, prune: prune };
                    worker = new Worker('src/2x2solver/worker.js');
                    worker.postMessage(args);
                    if (worker) {
                        worker.onmessage = function (event) {
                            appendSol(scr2, event.data);
                        };
                    }
                } catch (e) {
                    console.log(e.message);
                    if (worker) {
                        worker.terminate();
                    }
                    worker = null;
                    const element = document.getElementById('result');
                    const content = document.createElement('a');
                    content.innerHTML = "Error: Search terminated due an error.<br>";
                    element.appendChild(content);
                    document.getElementById("solveButton").textContent = "Start";
                    return;
                }
            }

            function appendSol(scr, sol) {
                const element = document.getElementById('result');
                if (sol == "Search finished." || sol == "Already solved." || sol == "Error" || sol == "Unsolvable.") {
                    if (worker) {
                        worker.terminate();
                    }
                    worker = null;
                    const element = document.getElementById('result');
                    const content = document.createElement('a');
                    if (sol == "Error") {
                        content.innerHTML = "Error: Search terminated due to an error.<br>";
                    } else if (sol === "Already solved.") {
                        content.innerHTML = "Already solved.<br>";
                    } else if (sol === "Search finished.") {
                        content.innerHTML = "Search finished.<br>";
                    } else {
                        content.innerHTML = "Unsolvable.<br>";
                    }
                    element.appendChild(content);
                    document.getElementById("solveButton").textContent = "Start";
                    return;
                } else {
                    messageCount++;
                    const details = document.createElement('details');
                    if (messageCount === 1 || sol_input) {
                        details.setAttribute('open', '');
                    }
                    const summary = document.createElement('summary');
                    summary.textContent = messageCount + ": " + sol;
                    summary.setAttribute('translate', 'no');
                    const textNode = document.createTextNode(messageCount + ": " + sol);
                    const button = document.createElement('button');
                    button.classList.add('button', 'medium');
                    button.textContent = 'Add';
                    button.onclick = function () {
                        add(sol);
                    };
                    details.appendChild(button);
                    details.appendChild(summary);
                    try {
                        const sim = createPlayer(scr, sol);
                        details.appendChild(sim);
                    } catch (e) {
                        if (messageCount === 1) {
                            const lineBreak = document.createElement('br');
                            details.appendChild(lineBreak);
                            const content = document.createElement('a');
                            content.innerHTML = "Warning: Failed to create TwistyPlayer.<br>";
                            details.appendChild(content);
                        }
                    }
                    const { URL1: link1, URL2: link2 } = getLink(scr + "\n" + sol);
                    var link_element1 = document.createElement('a');
                    link_element1.href = link1;
                    link_element1.target = '_blank';
                    link_element1.rel = 'noopener noreferrer';
                    link_element1.textContent = 'alg.cubing.net';
                    link_element1.setAttribute('translate', 'no');
                    details.appendChild(link_element1);
                    var spaceElement = document.createElement('a');
                    spaceElement.innerHTML = "&nbsp;";
                    details.appendChild(spaceElement);
                    var link_element2 = document.createElement('a');
                    link_element2.href = link2;
                    link_element2.target = '_blank';
                    link_element2.rel = 'noopener noreferrer';
                    link_element2.textContent = 'cubedb.net';
                    link_element2.setAttribute('translate', 'no');
                    details.appendChild(link_element2);
                    var spaceElement2 = document.createElement('a');
                    spaceElement2.innerHTML = "&nbsp;";
                    details.appendChild(spaceElement2);
                    const currentUrl = new URL(window.location.href);
                    currentUrl.searchParams.set('index', `${messageCount}`);
                    currentUrl.searchParams.set('sol', sol.replace(/ /g, '_').replace(/'/g, '-'));
                    var link_element3 = document.createElement('a');
                    link_element3.href = currentUrl;
                    link_element3.target = '_blank';
                    link_element3.rel = 'noopener noreferrer';
                    link_element3.textContent = 'or18.github.io';
                    link_element3.setAttribute('translate', 'no');
                    details.appendChild(link_element3);
                    element.appendChild(details);
                    document.getElementById("countLine").value = messageCount;
                    if (messageCount === 1) {
                        try {
                            window.history.replaceState({}, '', currentUrl);
                        } catch (e) {
                            console.log(e.message);
                        }
                    }
                }
            }

            const textarea = document.getElementById('scr');
            const undoButton = document.getElementById('undo');
            const redoButton = document.getElementById('redo');
            let history_input = [];
            let currentIndex = -1;

            function save() {
                if (currentIndex < history_input.length - 1) {
                    history_input = history_input.slice(0, currentIndex + 1);
                }
                history_input.push(textarea.value);
                currentIndex++;
                updateButtons();
                try {
                    document.getElementById('show').innerHTML = '';
                    const sim = createPlayer(scr_fix2(textarea.value), '');
                    sim.controlPanel = "none";
                    document.getElementById('show').appendChild(sim);
                } catch (e) {
                    const content = document.createElement('a');
                    content.innerHTML = "Warning: Failed to create TwistyPlayer.<br>";
                    document.getElementById('show').appendChild(content);
                }
            }

            function reverseScramble() {
                if (typeof reverse !== "function") {
                    alert("Error: The required function is not initialized. Please reload the page manually.");
                    return;
                }
                const scr_val = document.getElementById("scr").value;
                const scr = scr_fix2(scr_val);
                if (scr === "") {
                    return;
                }
                document.getElementById("scr").value = reverse(scr);
                save();
            }

            function mirrorScramble() {
                if (typeof mirror !== "function") {
                    alert("Error: The required function is not initialized. Please reload the page manually.");
                    return;
                }
                const scr_val = document.getElementById("scr").value;
                const scr = scr_fix2(scr_val);
                if (scr === "") {
                    return;
                }
                document.getElementById("scr").value = mirror(scr);
                save();
            }

            function undo() {
                if (currentIndex > 0) {
                    currentIndex--;
                    textarea.value = history_input[currentIndex];
                    updateButtons();
                    try {
                        document.getElementById('show').innerHTML = '';
                        const sim = createPlayer(scr_fix2(textarea.value), '');
                        sim.controlPanel = "none";
                        document.getElementById('show').appendChild(sim);
                    } catch (e) {
                        const content = document.createElement('a');
                        content.innerHTML = "Warning: Failed to create TwistyPlayer.<br>";
                        document.getElementById('show').appendChild(content);
                    }
                }
            }

            function redo() {
                if (currentIndex < history_input.length - 1) {
                    currentIndex++;
                    textarea.value = history_input[currentIndex];
                    updateButtons();
                    try {
                        document.getElementById('show').innerHTML = '';
                        const sim = createPlayer(scr_fix2(textarea.value), '');
                        sim.controlPanel = "none";
                        document.getElementById('show').appendChild(sim);
                    } catch (e) {
                        const content = document.createElement('a');
                        content.innerHTML = "Warning: Failed to create TwistyPlayer.<br>";
                        document.getElementById('show').appendChild(content);
                    }
                }
            }

            function updateButtons() {
                undoButton.disabled = currentIndex <= 0;
                redoButton.disabled = currentIndex >= history_input.length - 1;
                const currentScr = document.getElementById("scr").value;
                if (currentScr === "") {
                    document.getElementById("reverse").classList.add("hidden");
                    document.getElementById("mirror").classList.add("hidden");
                } else {
                    document.getElementById("reverse").classList.remove("hidden");
                    document.getElementById("mirror").classList.remove("hidden");
                }
                updateUrlParams();
                if (currentIndex <= 0) {
                    undoButton.classList.add("hidden_small");
                } else {
                    undoButton.classList.remove("hidden_small");
                }
                if (currentIndex >= history_input.length - 1) {
                    redoButton.classList.add("hidden_small")
                } else {
                    redoButton.classList.remove("hidden_small");
                }
                if (currentIndex >= 0) {
                    const { URL1: link1, URL2: link2 } = getLink(currentScr);
                    document.getElementById("link_alg_cubing").href = link1;
                    document.getElementById("link_cubedb").href = link2;
                    document.getElementById("links").classList.remove("hidden");
                }
            }

            function add(s) {
                document.getElementById('scr').value += "\n" + s;
                save();
            }

            document.getElementById('header').addEventListener('click', function () {
                const url = new URL(window.location.href);
                url.search = '';
                window.location.href = url;
            });

            const details_preview = document.getElementById("details_preview");
            const summary_preview = document.getElementById("summary_preview");

            details_preview.addEventListener('toggle', () => {
                if (details_preview.open) {
                    summary_preview.textContent = "Hide Preview";
                } else {
                    summary_preview.textContent = "Show Preview";
                }
            });

            window.onload = function () {
                const urlParams = new URLSearchParams(window.location.search);
                const scrambleParam = urlParams.get(idToKeyMap['scr']);
                document.getElementById("result").innerHTML = "";
                if (scrambleParam) {
                    const scr = decodeURIComponent(scrambleParam.replace(/_/g, ' ').replace(/-/g, '\''));
                    document.getElementById('scr').value = scr;
                    const sol_num = urlParams.get('index');
                    const sol = urlParams.get('sol');
                    if (sol_num && sol) {
                        messageCount = Number(sol_num) - 1;
                        const sol_fixed = sol.replace(/_/g, ' ').replace(/-/g, '\'');
                        sol_input = true;
                        appendSol(scr, sol_fixed);
                        sol_input = false;
                        document.getElementById("countLine").value = 1;
                    } else {
                        document.getElementById("countLine").value = 0;
                    }
                }
                document.getElementById('scr').value = scrambleParam ? decodeURIComponent(scrambleParam.replace(/_/g, ' ').replace(/-/g, '\'')) : '';
                if (scrambleParam === '') {
                    document.getElementById("reverse").classList.add("hidden");
                    document.getElementById("mirror").classList.add("hidden");
                }
                undoButton.classList.add("hidden_small");
                redoButton.classList.add("hidden_small");
                setParamsFromUrl(urlParams);
                save();
            };
        </script>
</body>

</html>