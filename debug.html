<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rubik's Cube Solver</title>
    <script src="src/min2phase.js/min2phase.js"></script>
    <script src="src/functions/functions.js"></script>
    <script src="src/functions/list.js"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-MXJH30352W"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-MXJH30352W');
    </script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 0;
            background-color: #121212;
        }

        h1 {
            font-family: Arial, sans-serif;
            font-size: 24px;
            text-align: center;
            color: #ffffff;
        }

        h2,
        label {
            font-family: Arial, sans-serif;
            font-size: 20px;
            text-align: left;
            color: #ffffff;
        }

        textarea {
            font-family: Arial, sans-serif;
            width: 100%;
            max-width: 700px;
            height: 200px;
            font-size: 20px;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #41417f;
            border-radius: 4px;
            box-sizing: border-box;
            background-color: #1e1e1e;
            color: #ffffff;
        }

        input {
            font-family: Arial, sans-serif;
            width: 100%;
            max-width: 100px;
            height: 40px;
            font-size: 20px;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #41417f;
            border-radius: 4px;
            box-sizing: border-box;
            background-color: #1e1e1e;
            color: #ffffff;
        }

        select {
            font-family: Arial, sans-serif;
            max-width: 200px;
            font-size: 20px;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ffffff;
            border-radius: 4px;
            box-sizing: border-box;
            background-color: #1e1e1e;
            color: #ffffff;
            cursor: pointer;
        }

        .button {
            font-family: Arial, sans-serif;
            width: 100%;
            font-size: 20px;
            padding: 10px;
            background-color: #56567c;
            color: #ffffff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .medium {
            max-width: 100px;
        }

        .small {
            max-width: 40px;
        }

        button:hover {
            background-color: #4a4a6d;
        }

        summary {
            box-sizing: border-box;
            display: block;
            font-family: Arial, sans-serif;
            background-color: #1e1e1e;
            padding: 10px;
            font-size: 20px;
            border: 1px solid #41417f;
            border-radius: 4px;
            word-wrap: break-word;
            color: #ffffff;
            width: 100%;
            max-width: 700px;
            cursor: pointer;
        }

        .analyzer_result {
            color: #ffffff;

        }

        .panalyzer_result {
            color: #ffffff;
        }

        .pair_analyzer_result {
            color: #ffffff;

        }

        .pair_panalyzer_result {
            color: #ffffff;
        }

        table,
        ptable,
        pair_table,
        pair_ptable {
            width: 100%;
            max-width: 700px;
            max-height: 400px;
            overflow-x: auto;
            display: block;
        }

        th,
        td {
            text-align: left;
            white-space: nowrap;
            color: #ffffff;
            font-family: Arial, sans-serif;
            font-size: 20px;
            min-width: 40px;
            min-height: 40px;
        }

        td {
            cursor: pointer;
        }

        .hidden {
            display: none;
        }

        a,
        pre {
            color: #ffffff;
            font-family: Arial, sans-serif;
            font-size: 20px;
        }

        twisty-player {
            margin: 0;
            width: 100%;
            max-width: 600px;
        }

        .custom-checkbox {
            display: none;
        }

        .custom-checkbox+label {
            position: relative;
            padding-left: 33px;
            cursor: pointer;
            font-size: 20px;
            color: #ffffff;
            margin-right: 10x;
        }

        .custom-checkbox+label:before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            border: 2px solid #41417f;
            background-color: #1e1e1e;
        }

        .custom-checkbox:checked+label:before {
            background-color: #41417f;
            border-color: #41417f;
        }

        .custom-checkbox:checked+label:after {
            content: '';
            position: absolute;
            left: 9px;
            top: 5px;
            width: 5px;
            height: 10px;
            border: solid white;
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
        }

        fieldset {
            border: 1px solid #121212;
            border-radius: 4px;
            padding: 10px;
            background-color: #121212;
        }
    </style>
</head>

<body>
    <h1>Rubik's Cube Solver</h1>
    <h2>This is online solver for Rubik's cube cross, xcross, xxcross, xxxcross, xxxxcross, last layer substeps, last
        layer, F2L pairing. Pseudo F2L solver is also available. </h2>
    <a href="https://github.com/or18/RubiksSolverDemo">Source</a><br>
    <a href="https://or18.github.io/Rubiks-cube-xcross-solver/">Old Demo</a><br>
    <textarea id="error"></textarea><br>
    <label for="solver">Solver</label><br>
    <select id="solver" onchange="change()">
        <option value="F2L" selected>F2L Lite</option>
        <option value="F2L_pair">Pairing</option>
        <option value="PF2L">Pseudo F2L Lite</option>
        <option value="PF2L_pair">Pseudo Pairing</option>
        <option value="LS">LL Substeps Lite</option>
        <option value="LL">LL Lite</option>
        <option value="LU">LL AUF Lite</option>
        <option value="tp">Two Phase</option>
        <option value="F2L2">F2L</option>
        <option value="LS2">LL Substeps</option>
        <option value="LL2">LL</option>
        <option value="LU2">LL AUF</option>
    </select>
    <button id="undo" class="button small" onclick="undo()">←</button>
    <button id="redo" class="button small" onclick="redo()">→</button><br>

    <textarea id="scr" rows="10" cols="10" placeholder="The string after // on each line is recognized as a comment. Write the //setup comment in the appropriate position when viewing on alg.cubing.net or cubedb.net." onchange="save()"></textarea><br>
    <button id="gen" class="button medium" onclick="genscr()">Random</button>
    <button id="reverse" class="button medium" onclick="reverse()">Reverse</button>
    <button id="mirror" class="button medium" onclick="mirror()">Mirror</button><br><br>
    <div id="show"></div>
    <pre id="links"
        class="hidden"><a id="link_alg_cubing" href="https://alg.cubing.net/" target="_blank" rel="noopener noreferrer">alg.cubing.net</a>  <a id="link_cubedb" href="https://cubedb.net/?puzzle=3x3" target="_blank" rel="noopener noreferrer">cubedb.net</a></pre>

    <div id="analyze">
        <label for="analyzer_rotation_option">Analyzer Options</label>
        <fieldset id="analyzer_rotation_option">
            <input type="checkbox" id="checkboxD_analyzer" class="custom-checkbox analyzer" value="D" checked>
            <label for="checkboxD_analyzer">D</label>
            <input type="checkbox" id="checkboxU_analyzer" class="custom-checkbox analyzer" value="U">
            <label for="checkboxU_analyzer">U</label>
            <input type="checkbox" id="checkboxL_analyzer" class="custom-checkbox analyzer" value="L">
            <label for="checkboxL_analyzer">L</label>
            <input type="checkbox" id="checkboxR_analyzer" class="custom-checkbox analyzer" value="R">
            <label for="checkboxR_analyzer">R</label>
            <input type="checkbox" id="checkboxF_analyzer" class="custom-checkbox analyzer" value="F">
            <label for="checkboxF_analyzer">F</label>
            <input type="checkbox" id="checkboxB_analyzer" class="custom-checkbox analyzer" value="B">
            <label for="checkboxB_analyzer">B</label>
        </fieldset>
        <select id="analyzer_option">
            <option value="cross">cross</option>
            <option value="xcross">xcross</option>
            <option value="xxcross">xxcross</option>
            <option value="xxxcross">xxxcross</option>
            <option value="2x">cross, x</option>
            <option value="3x">cross, x, xx</option>
            <option value="4x">cross, x, xx, xxx</option>
        </select>
        <button id="analyzer" class="button medium" onclick="analyze()">Analyze</button>
        <div id="table"></div>
    </div>

    <div id="panalyze">
        <label for="panalyzer_rotation_option">Analyzer Options</label>
        <fieldset id="panalyzer_rotation_option">
            <input type="checkbox" id="checkboxD_panalyzer" class="custom-checkbox panalyzer" value="D" checked>
            <label for="checkboxD_panalyzer">D</label>
            <input type="checkbox" id="checkboxU_panalyzer" class="custom-checkbox panalyzer" value="U">
            <label for="checkboxU_panalyzer">U</label>
            <input type="checkbox" id="checkboxL_panalyzer" class="custom-checkbox panalyzer" value="L">
            <label for="checkboxL_panalyzer">L</label>
            <input type="checkbox" id="checkboxR_panalyzer" class="custom-checkbox panalyzer" value="R">
            <label for="checkboxR_panalyzer">R</label>
            <input type="checkbox" id="checkboxF_panalyzer" class="custom-checkbox panalyzer" value="F">
            <label for="checkboxF_panalyzer">F</label>
            <input type="checkbox" id="checkboxB_panalyzer" class="custom-checkbox panalyzer" value="B">
            <label for="checkboxB_panalyzer">B</label>
        </fieldset>
        <select id="panalyzer_option">
            <option value="cross">cross</option>
            <option value="xcross">xcross</option>
            <option value="xxcross">xxcross</option>
            <option value="xxxcross">xxxcross</option>
            <option value="2x">cross, x</option>
            <option value="3x">cross, x, xx</option>
            <option value="4x">cross, x, xx, xxx</option>
        </select>
        <button id="panalyzer" class="button medium" onclick="panalyze()">Analyze</button>
        <div id="ptable"></div>
    </div>

    <div id="pair_analyze">
        <label for="pair_analyzer_rotation_option">Analyzer Options</label>
        <fieldset id="pair_analyzer_rotation_option">
            <input type="checkbox" id="checkboxD_pair_analyzer" class="custom-checkbox pair_analyzer" value="D" checked>
            <label for="checkboxD_pair_analyzer">D</label>
            <input type="checkbox" id="checkboxU_pair_analyzer" class="custom-checkbox pair_analyzer" value="U">
            <label for="checkboxU_pair_analyzer">U</label>
            <input type="checkbox" id="checkboxL_pair_analyzer" class="custom-checkbox pair_analyzer" value="L">
            <label for="checkboxL_pair_analyzer">L</label>
            <input type="checkbox" id="checkboxR_pair_analyzer" class="custom-checkbox pair_analyzer" value="R">
            <label for="checkboxR_pair_analyzer">R</label>
            <input type="checkbox" id="checkboxF_pair_analyzer" class="custom-checkbox pair_analyzer" value="F">
            <label for="checkboxF_pair_analyzer">F</label>
            <input type="checkbox" id="checkboxB_pair_analyzer" class="custom-checkbox pair_analyzer" value="B">
            <label for="checkboxB_pair_analyzer">B</label>
        </fieldset>
        <select id="pair_analyzer_option">
            <option value="cross">cross</option>
            <option value="xcross">xcross</option>
            <option value="xxcross">xxcross</option>
            <option value="xxxcross">xxxcross</option>
            <option value="2x">cross, x</option>
            <option value="3x">cross, x, xx</option>
            <option value="4x">cross, x, xx, xxx</option>
        </select>
        <button id="pair_analyzer" class="button medium" onclick="pair_analyze()">Analyze</button>
        <div id="pair_table"></div>
    </div>

    <div id="pair_panalyze">
        <label for="pair_panalyzer_rotation_option">Analyzer Options</label>
        <fieldset id="pair_panalyzer_rotation_option">
            <input type="checkbox" id="checkboxD_pair_panalyzer" class="custom-checkbox pair_panalyzer" value="D"
                checked>
            <label for="checkboxD_pair_panalyzer">D</label>
            <input type="checkbox" id="checkboxU_pair_panalyzer" class="custom-checkbox pair_panalyzer" value="U">
            <label for="checkboxU_pair_panalyzer">U</label>
            <input type="checkbox" id="checkboxL_pair_panalyzer" class="custom-checkbox pair_panalyzer" value="L">
            <label for="checkboxL_pair_panalyzer">L</label>
            <input type="checkbox" id="checkboxR_pair_panalyzer" class="custom-checkbox pair_panalyzer" value="R">
            <label for="checkboxR_pair_panalyzer">R</label>
            <input type="checkbox" id="checkboxF_pair_panalyzer" class="custom-checkbox pair_panalyzer" value="F">
            <label for="checkboxF_pair_panalyzer">F</label>
            <input type="checkbox" id="checkboxB_pair_panalyzer" class="custom-checkbox pair_panalyzer" value="B">
            <label for="checkboxB_pair_panalyzer">B</label>
        </fieldset>
        <label for="pair_panalyzer_memory_option">Memory</label><br>
        <select id="pair_panalyzer_memory_option">
            <option value="model1">&lt; 400 MB</option>
            <option value="model2">&lt; 100 MB</option>
        </select><br>
        <select id="pair_panalyzer_option">
            <option value="cross">cross</option>
            <option value="xcross">xcross</option>
            <option value="xxcross">xxcross</option>
            <option value="xxxcross">xxxcross</option>
            <option value="2x">cross, x</option>
            <option value="3x">cross, x, xx</option>
            <option value="4x">cross, x, xx, xxx</option>
        </select>
        <button id="pair_panalyzer" class="button medium" onclick="pair_panalyze()">Analyze</button>
        <div id="pair_ptable"></div>
    </div><br>
    <label for="rot">Rotation: </label>
    <select id="rot">
        <option value="">None</option>
        <option value="y">y</option>
        <option value="y2">y2</option>
        <option value="y'">y'</option>
        <option value="z2">z2</option>
        <option value="z2 y">z2 y</option>
        <option value="z2 y2">z2 y2</option>
        <option value="z2 y'">z2 y'</option>
        <option value="z'">z'</option>
        <option value="z' y">z' y</option>
        <option value="z' y2">z' y2</option>
        <option value="z' y'">z' y'</option>
        <option value="z">z</option>
        <option value="z y">z y</option>
        <option value="z y2">z y2</option>
        <option value="z y'">z y'</option>
        <option value="x'">x'</option>
        <option value="x' y">x' y</option>
        <option value="x' y2">x' y2</option>
        <option value="x' y'">x' y'</option>
        <option value="x2">x2</option>
        <option value="x2 y">x2 y</option>
        <option value="x2 y2">x2 y2</option>
        <option value="x2 y'">x2 y'</option>
        <option value="x">x</option>
        <option value="x y">x y</option>
        <option value="x y2">x y2</option>
        <option value="x y'">x y'</option>
    </select><br>
    <div id="option_for_F2L" class="hidden">
        <label for="rot">Slot: </label>
        <select id="slot">
            <option value="">None</option>
            <option value="BL">BL</option>
            <option value="BR">BR</option>
            <option value="FR">FR</option>
            <option value="FL">FL</option>
            <option value="BL BR">BL BR</option>
            <option value="BL FR">BL FR</option>
            <option value="BL FL">BL FL</option>
            <option value="BR FR">BR FR</option>
            <option value="BR FL">BR FL</option>
            <option value="FR FL">FR FL</option>
            <option value="BL BR FR">BL BR FR</option>
            <option value="BL BR FL">BL BR FL</option>
            <option value="BL FR FL">BL FR FL</option>
            <option value="BR FR FL">BR FR FL</option>
            <option value="BL BR FR FL">BL BR FR FL</option>
        </select>
    </div>
    <div id="option_for_PF2L" class="hidden">
        <div id="option_for_PF2LE">
            <label for="pslot_edge">Pseudo Edge: </label>
            <select id="pslot_edge" onchange="updateDropdown()">
                <option value="">None</option>
                <option value="BL">BL</option>
                <option value="BR">BR</option>
                <option value="FR">FR</option>
                <option value="FL">FL</option>
                <option value="BL BR">BL BR</option>
                <option value="BL FR">BL FR</option>
                <option value="BL FL">BL FL</option>
                <option value="BR FR">BR FR</option>
                <option value="BR FL">BR FL</option>
                <option value="FR FL">FR FL</option>
                <option value="BL BR FR">BL BR FR</option>
                <option value="BL BR FL">BL BR FL</option>
                <option value="BL FR FL">BL FR FL</option>
                <option value="BR FR FL">BR FR FL</option>
            </select>
        </div>
        <div id="option_for_PF2LC" class="hidden">
            <label for="pslot_corner">Pseudo Corner: </label>
            <select id="pslot_corner">
            </select>
        </div>
    </div>

    <div id="option_for_F2L2" class="hidden">
        <label for="rot">Slot: </label>
        <select id="slot2" onchange="updateDropdown2()">
            <option value="">None</option>
            <option value="BL">BL</option>
            <option value="BR">BR</option>
            <option value="FR">FR</option>
            <option value="FL">FL</option>
            <option value="BL BR">BL BR</option>
            <option value="BL FR">BL FR</option>
            <option value="BL FL">BL FL</option>
            <option value="BR FR">BR FR</option>
            <option value="BR FL">BR FL</option>
            <option value="FR FL">FR FL</option>
            <option value="BL BR FR">BL BR FR</option>
            <option value="BL BR FL">BL BR FL</option>
            <option value="BL FR FL">BL FR FL</option>
            <option value="BR FR FL">BR FR FL</option>
        </select>
    </div>
    <div id="option_for_pair_F2L" class="hidden">
        <label for="pair_slot">Pair Slot: </label>
        <select id="pair_slot">
            <option value="BL">BL</option>
            <option value="BR">BR</option>
            <option value="FR">FR</option>
            <option value="FL">FL</option>
        </select>
    </div>
    <div id="option_for_PF2L2" class="hidden">
        <div id="option_for_PF2LE2">
            <label for="pslot_edge2">Pseudo Edge: </label>
            <select id="pslot_edge2" onchange="updateDropdown3()">
                <option value="">None</option>
                <option value="BL">BL</option>
                <option value="BR">BR</option>
                <option value="FR">FR</option>
                <option value="FL">FL</option>
                <option value="BL BR">BL BR</option>
                <option value="BL FR">BL FR</option>
                <option value="BL FL">BL FL</option>
                <option value="BR FR">BR FR</option>
                <option value="BR FL">BR FL</option>
                <option value="FR FL">FR FL</option>
                <option value="BL BR FR">BL BR FR</option>
                <option value="BL BR FL">BL BR FL</option>
                <option value="BL FR FL">BL FR FL</option>
                <option value="BR FR FL">BR FR FL</option>
            </select>
        </div>
        <div id="option_for_PF2LC2" class="hidden">
            <label for="pslot_corner2">Pseudo Corner: </label>
            <select id="pslot_corner2" onchange="updateDropdown4()">
            </select>
        </div>
        <div id="option_for_pair_PF2L" class="hidden">
            <div id="option_for_pair_PF2LE">
                <label for="pair_pslot_edge">Pair Edge: </label>
                <select id="pair_pslot_edge">
                    <option value="BL">BL</option>
                    <option value="BR">BR</option>
                    <option value="FR">FR</option>
                    <option value="FL">FL</option>
                </select>
            </div>
            <div id="option_for_pair_PF2LC">
                <label for="pair_pslot_corner">Pair Corner: </label>
                <select id="pair_pslot_corner">
                    <option value="BL">BL</option>
                    <option value="BR">BR</option>
                    <option value="FR">FR</option>
                    <option value="FL">FL</option>
                </select>
            </div>
        </div>
    </div>

    <div id="option_for_LS" class="hidden">
        <label for="ll">LL option: </label>
        <select id="ll">
            <option value="">None</option>
            <option value="CP">CP</option>
            <option value="CO">CO</option>
            <option value="EP">EP</option>
            <option value="EO">EO</option>
            <option value="CP CO">CP CO</option>
            <option value="CP EP">CP EP</option>
            <option value="CP EO">CP EO</option>
            <option value="CO EP">CO EP</option>
            <option value="CO EO">CO EO</option>
            <option value="EP EO">EP EO</option>
            <option value="CP CO EP">CP CO EP</option>
            <option value="CP CO EO">CP CO EO</option>
            <option value="CP EO EP">CP EO EP</option>
            <option value="CO EP EO">CO EP EO</option>
            <option value="CP CO EP EO">CP CO EP EO</option>
        </select>
    </div>
    <div id="basic input">
        <label for="len">Max Length: </label>
        <input type="number" id="len" value="20" min="1" required><br>
        <label for="num">Max Count: </label>
        <input type="number" id="num" value="20" min=1 required><br>
        <label for="res_drop">Restrict: </label>
        <select id="res_drop" onchange="res_change()">
            <option value="UDLRFB">UDLRFB</option>
            <option value="UDRF">UDRF</option>
            <option value="UDLF">UDLF</option>
            <option value="UDLR">UDLR</option>
            <option value="UDFB">UDFB</option>
            <option value="URF">URF</option>
            <option value="ULF">ULF</option>
            <option value="URB">URB</option>
            <option value="ULB">ULB</option>
            <option value="UDR">UDR</option>
            <option value="UDL">UDL</option>
            <option value="ULR">ULR</option>
            <option value="UR">UR</option>
            <option value="UL">UL</option>
            <option value="custom">Custom</option>
        </select>
        <input type="text" id="res" value="UDLRFB" class="hidden" required><br>
    </div>
    <a class="hidden" id="tp_alert">Two Phase Solver output 1 solution.</a><br>
    <button id="solveButton" class="button medium" onclick="startWorker()">Start</button><br>
    <label for="countLine">Number of solutions: </label>
    <input type="text" id="countLine" value="0" readonly>
    <div id="result"></div>

    <script type="module">
        import { TwistyPlayer } from "https://cdn.cubing.net/v0/js/cubing/twisty";
        function createPlayer(setup, sol) {
            const player = new TwistyPlayer({
                puzzle: "3x3x3",
                experimentalSetupAlg: setup,
                alg: sol,
                background: "none"
            });
            return player;
        }
        window.createPlayer = createPlayer;
    </script>

    <script>
        let worker;
        let worker2;
        let worker3;
        let worker4;
        let worker5;
        let messageCount = 0;
        let messageCount_analyzer = 0;
        let messageCount_panalyze = 0;
        let messageCount_pair_analyzer = 0;
        let messageCount_pair_panalyze = 0;
        let option_table;
        let option_ptable;
        let option_pair_table;
        let option_pair_ptable;
        let list_table;
        let list_ptable;
        let list_pair_table;
        let list_pair_ptable;

        function scr_fix(scr) {
            const fixed_scr = scr_fix2(scr);
            const output = fixed_scr.split('\n')
                .map(line => line.split('//')[0].trim())
                .filter(line => line.length > 0)
                .join('\n');
            return output;
        }

        function scr_fix2(scr) {
            const outputString = scr.split('\n').map(line => {
                const commentIndex = line.indexOf('//');
                if (commentIndex !== -1) {
                    const beforeComment = insertSpaces(line.slice(0, commentIndex));
                    const comment = line.slice(commentIndex);
                    return beforeComment + ' ' + comment.trim();
                } else {
                    return insertSpaces(line);
                }
            }).join('\n');
            return outputString;
        }

        function insertSpaces(input) {
            const keys = ["U", "U2", "U2'", "U'", "D", "D2", "D2'", "D'", "L", "L2", "L2'", "L'", "R", "R2", "R2'", "R'", "F", "F2", "F2'", "F'", "B", "B2", "B2'", "B'", "u", "u2", "u2'", "u'", "d", "d2", "d2'", "d'", "l", "l2", "l2'", "l'", "r", "r2", "r2'", "r'", "f", "f2", "f2'", "f'", "b", "b2", "b2'", "b'", "Uw", "Uw2", "Uw2'", "Uw'", "Dw", "Dw2", "Dw2'", "Dw'", "Lw", "Lw2", "Lw2'", "Lw'", "Rw", "Rw2", "Rw2'", "Rw'", "Fw", "Fw2", "Fw2'", "Fw'", "Bw", "Bw2", "Bw2'", "Bw'", "M", "M2", "M2'", "M'", "S", "S2", "S2'", "S'", "E", "E2", "E2'", "E'", "x", "x2", "x2'", "x'", "y", "y2", "y2'", "y'", "z", "z2", "z2'", "z'"];
            const regex = new RegExp(`(${keys.join('|')})`, 'g');
            return input.replace(regex, ' $1').trim()
                .replace(/\s+/g, ' ');
        }

        function replaceCharacters(input) {
            return input
                .replace(/'/g, '-')
                .replace(/\n/g, '%0A')
                .replace(/\//g, '%2F')
                .replace(/ /g, '_');
        }

        function splitAtLastScramble(input) {
            const scrambleRegex = /\/\/\s*setup/g;
            let match;
            const index = input.search(scrambleRegex);
            if (index !== -1) {
                const scrambleLineEnd = input.indexOf('\n', index);
                const scrambleLine = input.slice(index, scrambleLineEnd !== -1 ? scrambleLineEnd : undefined).trim();
                const aboveScramble = input.slice(0, scrambleLineEnd !== -1 ? scrambleLineEnd : input.length).trim();
                const belowScramble = input.slice(index + scrambleLine.length).trim();
                return { aboveScramble, belowScramble };
            } else {
                return { aboveScramble: input.trim(), belowScramble: '' };
            }
        }

        function getLink(scr) {
            const fixed_scr = scr_fix2(scr);
            const { aboveScramble, belowScramble } = splitAtLastScramble(fixed_scr);
            const transformedAbove = replaceCharacters(aboveScramble);
            const transformedBelow = replaceCharacters(belowScramble);
            const URL1 = "https://alg.cubing.net/?setup=" + transformedAbove + "&alg=" + transformedBelow + "%0A&puzzle=3x3x3";
            const URL2 = "https://cubedb.net/?puzzle=3x3&scramble=" + transformedAbove + "&alg=" + transformedBelow + "%0A";
            return { URL1, URL2 };
        }

        function startWorker() {
            try{
            if (worker) {
                worker.terminate();
                worker = null;
                const element = document.getElementById('result');
                const content = document.createElement('a');
                content.textContent = "Search terminated";
                element.appendChild(content);
                document.getElementById("solveButton").textContent = "Start";
                return;
            }
            document.getElementById("countLine").value = 0;
            document.getElementById("result").innerHTML = "";
            messageCount = 0;
            const solver = document.getElementById('solver').value;
            let scr_val = document.getElementById("scr").value;
            scr = scr_fix(scr_val);
            let scr2 = scr_fix2(scr_val);
            if (scr === "") {
                const element = document.getElementById('result');
                const content = document.createElement('a');
                content.textContent = "Input scramble";
                element.appendChild(content);
                return;
            }
            const rot = document.getElementById('rot').value;
            const slot = document.getElementById('slot').value;
            const slot2 = document.getElementById('slot2').value;
            const pair_slot = document.getElementById('pair_slot').value;
            const pslot_e = document.getElementById('pslot_edge').value;
            const pslot_c = document.getElementById('pslot_corner').value;
            const pslot_e2 = document.getElementById('pslot_edge2').value;
            const pslot_c2 = document.getElementById('pslot_corner2').value;
            const pair_pslot_e = document.getElementById('pair_pslot_edge').value;
            const pair_pslot_c = document.getElementById('pair_pslot_corner').value;
            const ll = document.getElementById('ll').value
            const num = document.getElementById('num').value;
            const len = document.getElementById('len').value;
            var restrict = document.getElementById('res_drop').value;
            if (restrict === "custom") {
                restrict = document.getElementById('res').value;
            }
            document.getElementById("solveButton").textContent = "End";

            if (solver === "F2L" || solver === "LS" || solver === "LL" || solver == "LU") {
                const args = { solver: solver, scr: convert(scr), rot: rot, slot: slot, ll: ll, num: num, len: len, restrict: restrict };
                worker = new Worker('src/crossSolver/worker.js');
                worker.postMessage(args);
            } else if (solver === "F2L2" || solver === "LS2" || solver === "LL2" || solver == "LU2") {
                const args = { solver: solver, scr: convert(scr), rot: rot, slot: slot, ll: ll, num: num, len: len, restrict: restrict };
                worker = new Worker('src/highMemorySolver/worker2.js');
                worker.postMessage(args);
            } else if (solver === "PF2L") {
                const args = { solver: solver, scr: convert(scr), rot: rot, slot: pslot_e, pslot: pslot_c, num: num, len: len, restrict: restrict };
                worker = new Worker('src/pseudoCrossSolver/worker3.js');
                worker.postMessage(args);
            } else if (solver === "F2L_pair") {
                const args = { scr: convert(scr), rot: rot, slot: slot2, pslot: pair_slot, num: num, len: len, restrict: restrict };
                worker = new Worker('src/F2L_PairingSolver/worker_pairing.js');
                worker.postMessage(args);
            } else if (solver === "PF2L_pair") {
                const args = { scr: convert(scr), rot: rot, slot: pslot_e2, pslot: pslot_c2, a_slot: pair_pslot_e, a_pslot: pair_pslot_c, num: num, len: len, restrict: restrict };
                worker = new Worker('src/pseudoPairingSolver/workerPseudoPairing.js');
                worker.postMessage(args);
            } else if (solver === "tp") {
                const sol = min2phase.solve(generateTwoPhaseInput(convert(scr + " " + rot)));
                appendSol(scr2, rot + " " + sol);
                const element = document.getElementById('result');
                const content = document.createElement('a');
                content.textContent = "Search terminated";
                element.appendChild(content);
                document.getElementById("solveButton").textContent = "Start";
            }
            worker.onmessage = function (event) {
                appendSol(scr2, event.data);
            };
        }catch(e){
            document.getElementById("error").value += e+"\n";
        }
        }

        function appendSol(scr, sol) {
            const element = document.getElementById('result');
            if (sol == "Search finished." || sol == "Already solved.") {
                if (worker) {
                    worker.terminate();
                    worker = null;
                    const element = document.getElementById('result');
                    const content = document.createElement('a');
                    content.textContent = "Search terminated";
                    element.appendChild(content);
                    document.getElementById("solveButton").textContent = "Start";
                    return;
                }
            } else {
                messageCount++;
                const details = document.createElement('details');
                if (messageCount === 1) {
                    details.setAttribute('open', '');
                }
                const summary = document.createElement('summary');
                summary.textContent = messageCount + ": " + sol;
                const textNode = document.createTextNode(messageCount + ": " + sol);
                const button = document.createElement('button');
                button.classList.add('button', 'medium');
                button.textContent = 'Add alg';
                button.onclick = function () {
                    add(sol);
                };
                details.appendChild(button);
                details.appendChild(summary);
                try {
                    const sim = createPlayer(scr_fix(scr), sol);
                    details.appendChild(sim);
                } catch (e) {
                    if (messageCount === 1) {
                        const lineBreak = document.createElement('br');
                        details.appendChild(lineBreak);
                        const content = document.createElement('a');
                        content.textContent = "Warning: Failed to create TwistyPlayer.";
                        details.appendChild(content);
                    }
                }
                const { URL1: link1, URL2: link2 } = getLink(scr + "\n" + sol);
                var link_element1 = document.createElement('a');
                link_element1.href = link1;
                link_element1.target = '_blank';
                link_element1.rel = 'noopener noreferrer';
                link_element1.textContent = 'alg.cubing.net';
                details.appendChild(link_element1);
                var spaceElement = document.createElement('a');
                spaceElement.innerHTML = "&nbsp;&nbsp;";
                details.appendChild(spaceElement);
                var link_element2 = document.createElement('a');
                link_element2.href = link2;
                link_element2.target = '_blank';
                link_element2.rel = 'noopener noreferrer';
                link_element2.textContent = 'cubedb.net';
                details.appendChild(link_element2);
                details.style.marginBottom = '10px';
                element.appendChild(details);
                document.getElementById("countLine").value = messageCount;
            }
        }

        function change() {
            const selectedValue = document.getElementById("solver").value;
            if (selectedValue === "F2L2" || selectedValue === "LS2" || selectedValue === "LL2" || selectedValue == "LU2") {
                alert("Warning: Requires up to 1.7 GB of memory")
            }
            document.getElementById("basic input").classList.remove("hidden");
            document.getElementById("tp_alert").classList.add("hidden");
            document.getElementById("option_for_F2L").classList.add("hidden");
            document.getElementById("option_for_F2L2").classList.add("hidden");
            document.getElementById("option_for_LS").classList.add("hidden");
            document.getElementById("analyze").classList.add("hidden");
            document.getElementById("panalyze").classList.add("hidden");
            document.getElementById("option_for_PF2L").classList.add("hidden");
            document.getElementById("option_for_PF2L2").classList.add("hidden");
            document.getElementById("option_for_pair_F2L").classList.add("hidden");
            document.getElementById("option_for_pair_PF2L").classList.add("hidden");
            document.getElementById("pair_analyze").classList.add("hidden");
            document.getElementById("pair_panalyze").classList.add("hidden");
            document.getElementById("tp_alert").classList.add("hidden");
            if (selectedValue === "F2L" || selectedValue === "F2L2") {
                document.getElementById("option_for_F2L").classList.remove("hidden");
                document.getElementById("analyze").classList.remove("hidden");
            } else if (selectedValue === "LS" || selectedValue === "LS2") {
                document.getElementById("option_for_LS").classList.remove("hidden");
            } else if (selectedValue === "PF2L") {
                document.getElementById("option_for_PF2L").classList.remove("hidden");
                document.getElementById("panalyze").classList.remove("hidden");
            } else if (selectedValue === "F2L_pair") {
                document.getElementById("option_for_F2L2").classList.remove("hidden");
                document.getElementById("option_for_pair_F2L").classList.remove("hidden");
                document.getElementById("pair_analyze").classList.remove("hidden");
            } else if (selectedValue === "PF2L_pair") {
                document.getElementById("option_for_PF2L2").classList.remove("hidden");
                document.getElementById("option_for_pair_PF2L").classList.remove("hidden");
                document.getElementById("pair_panalyze").classList.remove("hidden");
                document.getElementById("basic input").classList.add("hidden");
            } else if (selectedValue === "tp") {
                document.getElementById("tp_alert").classList.remove("hidden");
                document.getElementById("basic input").classList.add("hidden");
            }
        }

        function res_change() {
            document.getElementById("res").classList.add("hidden");
            const selectedValue = document.getElementById("res_drop").value;
            if (selectedValue === "custom") {
                document.getElementById("res").classList.remove("hidden");
            }
        }

        const textarea = document.getElementById('scr');
        const undoButton = document.getElementById('undo');
        const redoButton = document.getElementById('redo');
        let history = [];
        let currentIndex = -1;

        function save() {
            if (currentIndex < history.length - 1) {
                history = history.slice(0, currentIndex + 1);
            }
            history.push(textarea.value);
            currentIndex++;
            updateButtons();
            try {
                document.getElementById('show').innerHTML = '';
                const sim = createPlayer(textarea.value, '');
                sim.controlPanel = "none";
                document.getElementById('show').appendChild(sim);
            } catch (e) {
                const content = document.createElement('a');
                content.textContent = "Warning: Failed to create TwistyPlayer.";
                document.getElementById('show').appendChild(content);
            }
        }

        function genscr() {
            var cube = min2phase.randomCube();
            var solution = min2phase.solve(cube);
            document.getElementById('scr').value = solution + "//setup\n";
            save();
        }

        function analyze() {
            try{
            if (worker2) {
                worker2.terminate();
                worker2 = null;
                document.getElementById("analyzer").textContent = "Analyze";
                option_table = {
                    valueNames: ["No", "slot", "D", "U", "L", "R", "F", "B"]
                };
                list_table = new List('table', option_table);
                return;
            }
            const content = "<a>Hint: You can start searching by clicking a cell in the table. You can sort the table by clicking on the headers.</a><br>";
            document.getElementById('table').innerHTML = content;
            let scr = document.getElementById("scr").value;
            const scramble = scr_fix(scr);
            const option = document.getElementById('analyzer_option').value;
            const checkboxes = document.querySelectorAll('#analyzer_rotation_option .analyzer');
            const values = [];
            checkboxes.forEach(function (checkbox) {
                if (checkbox.checked) {
                    values.push(checkbox.value);
                }
            });
            const rot_set = values.join('');
            messageCount_analyzer = -2;
            document.getElementById('table').innerHTML += "<a>Solved: </a>";
            const input = document.createElement('input');
            input.type = 'text';
            input.id = 'count_analyzer';
            input.readOnly = true;
            const input2 = document.createElement('input');
            input2.type = 'text';
            input2.id = 'count_analyzer_max';
            input2.readOnly = true;
            document.getElementById('table').appendChild(input);
            document.getElementById('table').innerHTML += "<a>/</a>";
            document.getElementById('table').appendChild(input2);
            worker2 = new Worker('src/crossAnalyzer/worker_analyzer.js');
            document.getElementById("analyzer").textContent = "End";
            worker2.onmessage = function (event) {
                if (messageCount_analyzer === -2) {
                    messageCount_analyzer++;
                    document.getElementById('table').innerHTML += event.data;
                } else if (messageCount_analyzer === -1) {
                    messageCount_analyzer++;
                    document.getElementById("count_analyzer_max").value = event.data;
                } else if (event.data === "Finished.") {
                    if (worker2) {
                        worker2.terminate();
                        worker2 = null;
                        document.getElementById("analyzer").textContent = "Analyze";
                        option_table = {
                            valueNames: ["No", "slot", "D", "U", "L", "R", "F", "B"]
                        };
                        list_table = new List('table', option_table);
                        return;
                    }
                } else {
                    messageCount_analyzer++;
                    document.querySelector('#analyzer_result tbody').insertAdjacentHTML('beforeend', event.data);
                    document.getElementById("count_analyzer").value = messageCount_analyzer;
                }
            };
            let cross = false;
            let xcross = false;
            let xxcross = false;
            let xxxcross = false;
            if (option === "cross" || option == "2x" || option === "3x" || option === "4x") {
                cross = true;
            }
            if (option === "xcross" || option == "2x" || option === "3x" || option === "4x") {
                xcross = true;
            }
            if (option === "xxcross" || option === "3x" || option === "4x") {
                xxcross = true;
            }
            if (option === "xxxcross" || option === "4x") {
                xxxcross = true;
            }
            const args = { scramble: convert(scramble), cross: cross, x: xcross, xx: xxcross, xxx: xxxcross, n: "1", rot_set: rot_set };
            worker2.postMessage(args);
        }catch(e){
            document.getElementById("error").value += e+"\n";
        }
        }

        function solve(slot_option, rotation_option) {
            document.getElementById("solver").value = "F2L";
            document.getElementById('rot').value = rotation_option;
            document.getElementById('slot').value = slot_option;
            document.getElementById('num').value = 20;
            document.getElementById('len').value = 20;
            document.getElementById('res_drop').value = "UDLRFB";
            res_change();
            startWorker();
        }

        Module.onRuntimeInitialized = function () {
            document.getElementById('reverse').onclick = function () {
                const scr = document.getElementById('scr').value;
                const scr_fixed = scr_fix2(scr);
                if (scr === "") {
                    return;
                }
                const lines = scr_fixed.split('\n');
                const processedLines = [];
                for (let i = lines.length - 1; i >= 0; i--) {
                    const line = lines[i];
                    const [alg, comment] = line.split('//');
                    const alg_revresed = Module.scr_reverse(alg.trim());
                    if (comment) {
                        processedLines.push(`${alg_revresed} // ${comment.trim()}`);
                    } else {
                        processedLines.push(alg_revresed);
                    }
                }
                const result = processedLines.join('\n');
                document.getElementById('scr').value = result.trim() + "\n";
                save();
            };
            document.getElementById('mirror').onclick = function () {
                const scr = document.getElementById('scr').value;
                const scr_fixed = scr_fix2(scr);
                if (scr === "") {
                    return;
                }
                const lines = scr_fixed.split('\n');
                const processedLines = [];
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i];
                    const [alg, comment] = line.split('//');
                    const alg_mirrored = Module.scr_mirror(alg.trim());
                    if (comment) {
                        processedLines.push(`${alg_mirrored} // ${comment.trim()}`);
                    } else {
                        processedLines.push(alg_mirrored);
                    }
                }
                const result = processedLines.join('\n');
                document.getElementById('scr').value = result.trim() + "\n";
                save();
            };
            window.convert = function (scramble) {
                const result = Module.scr_converter(scramble);
                return result;
            };
            window.generateTwoPhaseInput = function (scramble) {
                const result = Module.ScrambleToState(scramble);
                return result;
            }
        };

        function undo() {
            if (currentIndex > 0) {
                currentIndex--;
                textarea.value = history[currentIndex];
                updateButtons();
                try {
                    document.getElementById('show').innerHTML = '';
                    const sim = createPlayer(textarea.value, '');
                    sim.controlPanel = "none";
                    document.getElementById('show').appendChild(sim);
                } catch (e) {
                    const content = document.createElement('a');
                    content.textContent = "Warning: Failed to create TwistyPlayer.";
                    document.getElementById('show').appendChild(content);
                }
            }
        }

        function redo() {
            if (currentIndex < history.length - 1) {
                currentIndex++;
                textarea.value = history[currentIndex];
                updateButtons();
                try {
                    document.getElementById('show').innerHTML = '';
                    const sim = createPlayer(textarea.value, '');
                    sim.controlPanel = "none";
                    document.getElementById('show').appendChild(sim);
                } catch (e) {
                    const content = document.createElement('a');
                    content.textContent = "Warning: Failed to create TwistyPlayer.";
                    document.getElementById('show').appendChild(content);
                }
            }
        }

        function updateButtons() {
            try{
            undoButton.disabled = currentIndex <= 0;
            redoButton.disabled = currentIndex >= history.length - 1;
            if (currentIndex >= 0) {
                const scr = document.getElementById("scr").value;
                const { URL1: link1, URL2: link2 } = getLink(scr);
                document.getElementById("link_alg_cubing").href = link1;
                document.getElementById("link_cubedb").href = link2;
                document.getElementById("links").classList.remove("hidden");
            }
        }catch(e){
            document.getElementById("error").value += e+"\n";
        }
        }

        function updateDropdown() {
            try{
            const dropdownA = document.getElementById("pslot_edge");
            const dropdownB = document.getElementById("pslot_corner");
            document.getElementById("option_for_PF2LC").classList.add("hidden");
            const selectedValue = dropdownA.value;
            dropdownB.innerHTML = "";
            let options = [];
            if (selectedValue === "") {
                options = [
                    { value: "", text: "" },
                ];
            } else if (selectedValue === "BL" || selectedValue === "BR" || selectedValue === "FR" || selectedValue === "FL") {
                options = [
                    { value: "BL", text: "BL" },
                    { value: "BR", text: "BR" },
                    { value: "FR", text: "FR" },
                    { value: "FL", text: "FL" }
                ];
            } else if (selectedValue === "BL BR" || selectedValue === "BL FR" || selectedValue === "BL FL" || selectedValue === "BR FR" || selectedValue === "BR FL" || selectedValue === "FR FL") {
                options = [
                    { value: "BL BR", text: "BL BR" },
                    { value: "BL FR", text: "BL FR" },
                    { value: "BL FL", text: "BL FL" },
                    { value: "BR FR", text: "BR FR" },
                    { value: "BR FL", text: "BR FL" },
                    { value: "FR FL", text: "FR FL" }
                ];
            } else if (selectedValue === "BL BR FR" || selectedValue === "BL BR FL" || selectedValue === "BL FR FL" || selectedValue === "BR FR FL") {
                options = [
                    { value: "BL BR FR", text: "BL BR FR" },
                    { value: "BL BR FL", text: "BL BR FL" },
                    { value: "BL FR FL", text: "BL FR FL" },
                    { value: "BR FR FL", text: "BR FR FL" }
                ];
            }

            options.forEach(option => {
                const newOption = document.createElement("option");
                newOption.value = option.value;
                newOption.textContent = option.text;
                dropdownB.appendChild(newOption);
            });

            if (selectedValue !== "") {
                document.getElementById("option_for_PF2LC").classList.remove("hidden");
            }
        }catch(e){
            document.getElementById("error").value += e+"\n";
        }
        }

        function updateDropdown2() {
            try{
            const dropdownA = document.getElementById("slot2");
            const dropdownB = document.getElementById("pair_slot");
            const selectedValue = dropdownA.value;
            let selectedValueArray = selectedValue.split(" ");
            dropdownB.innerHTML = "";
            let options = [
                { value: "BL", text: "BL" },
                { value: "BR", text: "BR" },
                { value: "FR", text: "FR" },
                { value: "FL", text: "FL" }
            ];
            options = options.filter(option => !selectedValueArray.includes(option.value));
            options.forEach(option => {
                const newOption = document.createElement("option");
                newOption.value = option.value;
                newOption.textContent = option.text;
                dropdownB.appendChild(newOption);
            });
        }catch(e){
            document.getElementById("error").value += e+"\n";
        }
        }

        function updateDropdown3() {
            try{
            const dropdownA = document.getElementById("pslot_edge2");
            let dropdownB = document.getElementById("pslot_corner2");
            document.getElementById("option_for_PF2LC2").classList.add("hidden");
            let selectedValue = dropdownA.value;
            dropdownB.innerHTML = "";
            let options = [];
            if (selectedValue === "") {
                options = [
                    { value: "", text: "" },
                ];
            } else if (selectedValue === "BL" || selectedValue === "BR" || selectedValue === "FR" || selectedValue === "FL") {
                options = [
                    { value: "BL", text: "BL" },
                    { value: "BR", text: "BR" },
                    { value: "FR", text: "FR" },
                    { value: "FL", text: "FL" }
                ];
            } else if (selectedValue === "BL BR" || selectedValue === "BL FR" || selectedValue === "BL FL" || selectedValue === "BR FR" || selectedValue === "BR FL" || selectedValue === "FR FL") {
                options = [
                    { value: "BL BR", text: "BL BR" },
                    { value: "BL FR", text: "BL FR" },
                    { value: "BL FL", text: "BL FL" },
                    { value: "BR FR", text: "BR FR" },
                    { value: "BR FL", text: "BR FL" },
                    { value: "FR FL", text: "FR FL" }
                ];
            } else if (selectedValue === "BL BR FR" || selectedValue === "BL BR FL" || selectedValue === "BL FR FL" || selectedValue === "BR FR FL") {
                options = [
                    { value: "BL BR FR", text: "BL BR FR" },
                    { value: "BL BR FL", text: "BL BR FL" },
                    { value: "BL FR FL", text: "BL FR FL" },
                    { value: "BR FR FL", text: "BR FR FL" }
                ];
            }

            options.forEach(option => {
                const newOption = document.createElement("option");
                newOption.value = option.value;
                newOption.textContent = option.text;
                dropdownB.appendChild(newOption);
            });

            if (selectedValue !== "") {
                document.getElementById("option_for_PF2LC2").classList.remove("hidden");
            }

            dropdownB = document.getElementById("pair_pslot_edge");
            selectedValue = dropdownA.value;
            let selectedValueArray = selectedValue.split(" ");
            dropdownB.innerHTML = "";
            options = [
                { value: "BL", text: "BL" },
                { value: "BR", text: "BR" },
                { value: "FR", text: "FR" },
                { value: "FL", text: "FL" }
            ];
            options = options.filter(option => !selectedValueArray.includes(option.value));
            options.forEach(option => {
                const newOption = document.createElement("option");
                newOption.value = option.value;
                newOption.textContent = option.text;
                dropdownB.appendChild(newOption);
            });
            updateDropdown4();
        }catch(e){
            document.getElementById("error").value += e+"\n";
        }
        }

        function updateDropdown4() {
            try{
            const dropdownA = document.getElementById("pslot_corner2");
            const dropdownB = document.getElementById("pair_pslot_corner");
            const selectedValue = dropdownA.value;
            let selectedValueArray = selectedValue.split(" ");
            dropdownB.innerHTML = "";
            let options = [
                { value: "BL", text: "BL" },
                { value: "BR", text: "BR" },
                { value: "FR", text: "FR" },
                { value: "FL", text: "FL" }
            ];
            options = options.filter(option => !selectedValueArray.includes(option.value));
            options.forEach(option => {
                const newOption = document.createElement("option");
                newOption.value = option.value;
                newOption.textContent = option.text;
                dropdownB.appendChild(newOption);
            });
        }catch(e){
            document.getElementById("error").value += e+"\n";
        }
        }

        function panalyze() {
            try{
            if (worker3) {
                worker3.terminate();
                worker3 = null;
                document.getElementById("panalyzer").textContent = "Analyze";
                option_ptable = {
                    valueNames: ["No", "slot", "pslot", "D", "U", "L", "R", "F", "B"]
                };
                list_ptable = new List('ptable', option_ptable);
                return;
            }
            const content = "<a>Hint: You can start searching by clicking a cell in the table. You can sort the table by clicking on the headers.</a><br>";
            document.getElementById('ptable').innerHTML = content;
            let scr = document.getElementById("scr").value;
            const scramble = scr_fix(scr);
            const option = document.getElementById('panalyzer_option').value;
            const checkboxes = document.querySelectorAll('#panalyzer_rotation_option .panalyzer');
            const values = [];
            checkboxes.forEach(function (checkbox) {
                if (checkbox.checked) {
                    values.push(checkbox.value);
                }
            });
            const rot_set = values.join('');
            messageCount_panalyzer = -2;
            document.getElementById('ptable').innerHTML += "<a>Solved: </a>";
            const input = document.createElement('input');
            input.type = 'text';
            input.id = 'count_panalyzer';
            input.readOnly = true;
            const input2 = document.createElement('input');
            input2.type = 'text';
            input2.id = 'count_panalyzer_max';
            input2.readOnly = true;
            document.getElementById('ptable').appendChild(input);
            document.getElementById('ptable').innerHTML += "<a>/</a>";
            document.getElementById('ptable').appendChild(input2);
            worker3 = new Worker('src/pseudoCrossAnalyzer/worker_panalyzer.js');
            document.getElementById("panalyzer").textContent = "End";
            worker3.onmessage = function (event) {
                if (messageCount_panalyzer === -2) {
                    messageCount_panalyzer++;
                    document.getElementById('ptable').innerHTML += event.data;
                } else if (messageCount_panalyzer === -1) {
                    messageCount_panalyzer++;
                    document.getElementById("count_panalyzer_max").value = event.data;
                } else if (event.data === "Finished.") {
                    if (worker3) {
                        worker3.terminate();
                        worker3 = null;
                        document.getElementById("panalyzer").textContent = "Analyze";
                        option_ptable = {
                            valueNames: ["No", "slot", "pslot", "D", "U", "L", "R", "F", "B"]
                        };
                        list_ptable = new List('ptable', option_ptable);
                        return;
                    }
                } else {
                    messageCount_panalyzer++;
                    document.querySelector('#panalyzer_result tbody').insertAdjacentHTML('beforeend', event.data);
                    document.getElementById("count_panalyzer").value = messageCount_panalyzer;
                }
            };
            let cross = false;
            let xcross = false;
            let xxcross = false;
            let xxxcross = false;
            if (option === "cross" || option == "2x" || option === "3x" || option === "4x") {
                cross = true;
            }
            if (option === "xcross" || option == "2x" || option === "3x" || option === "4x") {
                xcross = true;
            }
            if (option === "xxcross" || option === "3x" || option === "4x") {
                xxcross = true;
            }
            if (option === "xxxcross" || option === "4x") {
                xxxcross = true;
            }
            const args = { scramble: convert(scramble), cross: cross, x: xcross, xx: xxcross, xxx: xxxcross, n: "1", rot_set: rot_set };
            worker3.postMessage(args);
        }catch(e){
            document.getElementById("error").value += e+"\n";
        }
        }

        function psolve(slot_option, pslot_option, rotation_option) {
            document.getElementById("solver").value = "PF2L";
            document.getElementById('rot').value = rotation_option;
            document.getElementById('pslot_edge').value = slot_option;
            updateDropdown();
            document.getElementById('pslot_corner').value = pslot_option;
            document.getElementById('num').value = 20;
            document.getElementById('len').value = 20;
            document.getElementById('res_drop').value = "UDLRFB";
            res_change();
            startWorker();
        }


        function pair_analyze() {
            try{
            if (worker4) {
                worker4.terminate();
                worker4 = null;
                document.getElementById("pair_analyzer").textContent = "Analyze";
                option_pair_table = {
                    valueNames: ["No", "slot", "pslot", "D", "U", "L", "R", "F", "B"]
                };
                list_pair_table = new List('pair_table', option_pair_table);
                return;
            }
            const content = "<a>Hint: You can start searching by clicking a cell in the table. You can sort the table by clicking on the headers.</a><br>";
            document.getElementById('pair_table').innerHTML = content;
            let scr = document.getElementById("scr").value;
            const scramble = scr_fix(scr);
            const option = document.getElementById('pair_analyzer_option').value;
            const checkboxes = document.querySelectorAll('#pair_analyzer_rotation_option .pair_analyzer');
            const values = [];
            checkboxes.forEach(function (checkbox) {
                if (checkbox.checked) {
                    values.push(checkbox.value);
                }
            });
            const rot_set = values.join('');
            messageCount_pair_analyzer = -2;
            document.getElementById('pair_table').innerHTML += "<a>Solved: </a>";
            const input = document.createElement('input');
            input.type = 'text';
            input.id = 'count_pair_analyzer';
            input.readOnly = true;
            const input2 = document.createElement('input');
            input2.type = 'text';
            input2.id = 'count_pair_analyzer_max';
            input2.readOnly = true;
            document.getElementById('pair_table').appendChild(input);
            document.getElementById('pair_table').innerHTML += "<a>/</a>";
            document.getElementById('pair_table').appendChild(input2);
            worker4 = new Worker('src/pairAnalyzer/worker_analyzer.js');
            document.getElementById("pair_analyzer").textContent = "End";
            worker4.onmessage = function (event) {
                if (messageCount_pair_analyzer === -2) {
                    messageCount_pair_analyzer++;
                    document.getElementById('pair_table').innerHTML += event.data;
                } else if (messageCount_pair_analyzer === -1) {
                    messageCount_pair_analyzer++;
                    document.getElementById("count_pair_analyzer_max").value = event.data;
                } else if (event.data === "Finished.") {
                    if (worker4) {
                        worker4.terminate();
                        worker4 = null;
                        document.getElementById("pair_analyzer").textContent = "Analyze";
                        option_pair_table = {
                            valueNames: ["No", "slot", "pslot", "D", "U", "L", "R", "F", "B"]
                        };
                        list_pair_table = new List('pair_table', option_pair_table);
                        return;
                    }
                } else {
                    messageCount_pair_analyzer++;
                    document.querySelector('#pair_analyzer_result tbody').insertAdjacentHTML('beforeend', event.data);
                    document.getElementById("count_pair_analyzer").value = messageCount_pair_analyzer;
                }
            };
            let cross = false;
            let xcross = false;
            let xxcross = false;
            let xxxcross = false;
            if (option === "cross" || option == "2x" || option === "3x" || option === "4x") {
                cross = true;
            }
            if (option === "xcross" || option == "2x" || option === "3x" || option === "4x") {
                xcross = true;
            }
            if (option === "xxcross" || option === "3x" || option === "4x") {
                xxcross = true;
            }
            if (option === "xxxcross" || option === "4x") {
                xxxcross = true;
            }
            const args = { scramble: convert(scramble), cross: cross, x: xcross, xx: xxcross, xxx: xxxcross, n: "1", rot_set: rot_set };
            worker4.postMessage(args);
        }catch(e){
            document.getElementById("error").value += e+"\n";
        }
        }

        function pair_solve(slot_option, pslot_option, rotation_option) {
            document.getElementById("solver").value = "F2L_pair";
            document.getElementById('rot').value = rotation_option;
            document.getElementById('slot2').value = slot_option;
            updateDropdown2();
            document.getElementById('pair_slot').value = pslot_option;
            document.getElementById('num').value = 20;
            document.getElementById('len').value = 20;
            document.getElementById('res_drop').value = "UDLRFB";
            res_change();
            startWorker();
        }

        function pair_panalyze() {
            try{
            if (worker5) {
                worker5.terminate();
                worker5 = null;
                document.getElementById("pair_panalyzer").textContent = "Analyze";
                option_pair_ptable = {
                    valueNames: ["No", "slot", "pslot", "a_slot", "a_pslot", "D", "U", "L", "R", "F", "B"]
                };
                list_pair_ptable = new List('pair_ptable', option_pair_ptable);
                return;
            }
            const content = "<a>Hint: You can start searching by clicking a cell in the table. You can sort the table by clicking on the headers.</a><br>";
            document.getElementById('pair_ptable').innerHTML = content;
            let scr = document.getElementById("scr").value;
            const scramble = scr_fix(scr);
            const option = document.getElementById('pair_panalyzer_option').value;
            const checkboxes = document.querySelectorAll('#pair_panalyzer_rotation_option .pair_panalyzer');
            const values = [];
            checkboxes.forEach(function (checkbox) {
                if (checkbox.checked) {
                    values.push(checkbox.value);
                }
            });
            const rot_set = values.join('');
            messageCount_pair_panalyzer = -2;
            document.getElementById('pair_ptable').innerHTML += "<a>Solved: </a>";
            const input = document.createElement('input');
            input.type = 'text';
            input.id = 'count_pair_panalyzer';
            input.readOnly = true;
            const input2 = document.createElement('input');
            input2.type = 'text';
            input2.id = 'count_pair_panalyzer_max';
            input2.readOnly = true;
            document.getElementById('pair_ptable').appendChild(input);
            document.getElementById('pair_ptable').innerHTML += "<a>/</a>";
            document.getElementById('pair_ptable').appendChild(input2);
            if (document.getElementById("pair_panalyzer_memory_option").value === "model1") {
                worker5 = new Worker('src/pseudoPairAnalyzer/worker_analyzer.js');
            } else {
                worker5 = new Worker('src/pseudoPairAnalyzer_lite/worker_analyzer.js');
            }
            document.getElementById("pair_panalyzer").textContent = "End";
            worker5.onmessage = function (event) {
                if (messageCount_pair_panalyzer === -2) {
                    messageCount_pair_panalyzer++;
                    document.getElementById('pair_ptable').innerHTML += event.data;
                } else if (messageCount_pair_panalyzer === -1) {
                    messageCount_pair_panalyzer++;
                    document.getElementById("count_pair_panalyzer_max").value = event.data;
                } else if (event.data === "Finished.") {
                    if (worker5) {
                        worker5.terminate();
                        worker5 = null;
                        document.getElementById("pair_panalyzer").textContent = "Analyze";
                        option_pair_ptable = {
                            valueNames: ["No", "slot", "pslot", "a_slot", "a_pslot", "D", "U", "L", "R", "F", "B"]
                        };
                        list_pair_ptable = new List('pair_ptable', option_pair_ptable);
                        return;
                    }
                } else {
                    messageCount_pair_panalyzer++;
                    document.querySelector('#pair_panalyzer_result tbody').insertAdjacentHTML('beforeend', event.data);
                    document.getElementById("count_pair_panalyzer").value = messageCount_pair_panalyzer;
                }
            };
            let cross = false;
            let xcross = false;
            let xxcross = false;
            let xxxcross = false;
            if (option === "cross" || option == "2x" || option === "3x" || option === "4x") {
                cross = true;
            }
            if (option === "xcross" || option == "2x" || option === "3x" || option === "4x") {
                xcross = true;
            }
            if (option === "xxcross" || option === "3x" || option === "4x") {
                xxcross = true;
            }
            if (option === "xxxcross" || option === "4x") {
                xxxcross = true;
            }
            const args = { scramble: convert(scramble), cross: cross, x: xcross, xx: xxcross, xxx: xxxcross, n: "1", rot_set: rot_set };
            worker5.postMessage(args);
        }catch(e){
            document.getElementById("error").value += e+"\n";
        }
        }

        function pair_psolve(slot_option, pslot_option, a_slot_option, a_pslot_option, rotation_option) {
            document.getElementById("solver").value = "PF2L_pair";
            document.getElementById('rot').value = rotation_option;
            document.getElementById('pslot_edge2').value = slot_option;
            updateDropdown3();
            document.getElementById('pslot_corner2').value = pslot_option;
            updateDropdown4();
            document.getElementById('pair_pslot_edge').value = a_slot_option;
            document.getElementById('pair_pslot_corner').value = a_pslot_option;
            document.getElementById('num').value = 20;
            document.getElementById('len').value = 20;
            document.getElementById('res_drop').value = "UDLRFB";
            res_change();
            startWorker();
        }

        function add(s) {
            document.getElementById('scr').value += "\n" + s;
            save();
        }

        window.onload = function () {
            change();
            updateDropdown();
        };
    </script>
</body>

</html>